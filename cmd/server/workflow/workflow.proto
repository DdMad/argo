syntax = "proto3";
option go_package = "github.com/argoproj/argo/cmd/server/workflow";


import "gogoproto/gogo.proto";
import "google/api/annotations.proto";
import "k8s.io/apimachinery/pkg/apis/meta/v1/generated.proto";
import "github.com/argoproj/argo/pkg/apis/workflow/v1alpha1/generated.proto";
import "k8s.io/api/core/v1/generated.proto";

// Workflow Service
//
// Workflow Service API performs CRUD actions against application resources
package workflow;


message WorkflowCreateRequest {
    github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow workflow = 1;
    string instanceID = 2;
    bool serverDryRun = 3;
    k8s.io.apimachinery.pkg.apis.meta.v1.CreateOptions createOptions = 4;
}

message WorkflowGetRequest {
    string workflowName = 1;
    string namespace = 2;
    k8s.io.apimachinery.pkg.apis.meta.v1.GetOptions getOptions = 3;
}

message WorkflowListRequest {
    string namespace = 1;
    k8s.io.apimachinery.pkg.apis.meta.v1.ListOptions listOptions = 2;
}

message WorkflowUpdateRequest {
    string workflowName = 1;
    string namespace = 2;
    bool memoized = 3;
}

message WorkflowLogRequest {
    string workflowName = 1;
    string namespace = 2;
    string podName = 3;
    k8s.io.api.core.v1.PodLogOptions logOptions = 4;
}

message WorkflowDeleteRequest {
    string workflowName = 1;
    string namespace = 2;
    k8s.io.apimachinery.pkg.apis.meta.v1.DeleteOptions deleteOptions = 3;
}

message WorkflowDeleteResponse {
}

message WatchWorkflowsRequest {
    string namespace = 1;
    k8s.io.apimachinery.pkg.apis.meta.v1.ListOptions listOptions = 2;
}

message WorkflowWatchEvent {
    // the type of change
    string type = 1;
    // the workflow
    github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow object = 2;
}

message WorkflowLintRequest {
    github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow workflow = 1;
}


message LogEntry {
    string content = 1;
}

service WorkflowService {
    rpc CreateWorkflow (WorkflowCreateRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http) = {
			post: "/api/v1/workflows"
			body: "*"
		};
    }

    rpc GetWorkflow (WorkflowGetRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http).get = "/api/v1/workflows/{namespace}/{workflowName}";
    }

    rpc ListWorkflows (WorkflowListRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.WorkflowList) {
        option (google.api.http).get = "/api/v1/workflows/{namespace}";
    }

    rpc WatchWorkflows (WatchWorkflowsRequest) returns (stream WorkflowWatchEvent) {
        option (google.api.http).get = "/api/v1/workflow-events/{namespace}";
    }

    rpc DeleteWorkflow (WorkflowDeleteRequest) returns (WorkflowDeleteResponse) {
        option (google.api.http).delete = "/api/v1/workflows/{namespace}/{workflowName}";
    }

    rpc RetryWorkflow (WorkflowUpdateRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http) = {
			put: "/api/v1/workflows/{namespace}/{workflowName}/retry"
			body: "*"
		};
    }

    rpc ResubmitWorkflow (WorkflowUpdateRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http) = {
			put: "/api/v1/workflows/{namespace}/{workflowName}/resubmit"
			body: "*"
		};
    }

    rpc ResumeWorkflow (WorkflowUpdateRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http) = {
			put: "/api/v1/workflows/{namespace}/{workflowName}/resume"
			body: "*"
		};
    }

    rpc SuspendWorkflow (WorkflowUpdateRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http) = {
			put: "/api/v1/workflows/{namespace}/{workflowName}/suspend"
			body: "*"
		};
    }

    rpc TerminateWorkflow (WorkflowUpdateRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http) = {
			put: "/api/v1/workflows/{namespace}/{workflowName}/terminate"
			body: "*"
		};
    }

    rpc LintWorkflow (WorkflowLintRequest) returns (github.com.argoproj.argo.pkg.apis.workflow.v1alpha1.Workflow) {
        option (google.api.http) = {
			post: "/api/v1/workflows/lint"
			body: "*"
		};
    }

    rpc PodLogs (WorkflowLogRequest) returns (stream LogEntry) {
        option (google.api.http).get = "/api/v1/workflows/{namespace}/{workflowName}/{podName}/log";
    }
}